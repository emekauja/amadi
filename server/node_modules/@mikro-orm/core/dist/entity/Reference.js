"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Reference = void 0;
const wrap_1 = require("./wrap");
class Reference {
    constructor(entity) {
        this.entity = entity;
        this.set(entity);
        const wrapped = wrap_1.wrap(this.entity, true);
        wrapped.__meta.primaryKeys.forEach(primaryKey => {
            Object.defineProperty(this, primaryKey, {
                get() {
                    return this.entity[primaryKey];
                },
            });
        });
        if (wrapped.__meta.serializedPrimaryKey && wrapped.__meta.primaryKeys[0] !== wrapped.__meta.serializedPrimaryKey) {
            Object.defineProperty(this, wrapped.__meta.serializedPrimaryKey, {
                get() {
                    return wrap_1.wrap(this.entity, true).__serializedPrimaryKey;
                },
            });
        }
    }
    static create(entity) {
        if (entity instanceof Reference) {
            return entity;
        }
        return new Reference(entity);
    }
    async load() {
        if (this.isInitialized()) {
            return this.entity;
        }
        return wrap_1.wrap(this.entity, true).init();
    }
    async get(prop) {
        await this.load();
        return this.entity[prop];
    }
    set(entity) {
        if (entity instanceof Reference) {
            entity = entity.unwrap();
        }
        this.entity = entity;
    }
    unwrap() {
        return this.entity;
    }
    getEntity() {
        if (!this.isInitialized()) {
            throw new Error(`Reference<${this.__meta.name}> ${this.__primaryKey} not initialized`);
        }
        return this.entity;
    }
    getProperty(prop) {
        return this.getEntity()[prop];
    }
    isInitialized() {
        return wrap_1.wrap(this.entity, true).isInitialized();
    }
    populated(populated) {
        wrap_1.wrap(this.entity, true).populated(populated);
    }
    toJSON(...args) {
        return wrap_1.wrap(this.entity).toJSON(...args);
    }
    get __primaryKey() {
        return wrap_1.wrap(this.entity, true).__primaryKey;
    }
    get __primaryKeys() {
        return wrap_1.wrap(this.entity, true).__primaryKeys;
    }
    get __uuid() {
        return wrap_1.wrap(this.entity, true).__uuid;
    }
    get __em() {
        return wrap_1.wrap(this.entity, true).__em;
    }
    get __internal() {
        return wrap_1.wrap(this.entity, true).__internal;
    }
    get __meta() {
        return wrap_1.wrap(this.entity, true).__meta;
    }
    get __populated() {
        return wrap_1.wrap(this.entity, true).__populated;
    }
    get __lazyInitialized() {
        return wrap_1.wrap(this.entity, true).__lazyInitialized;
    }
}
exports.Reference = Reference;
//# sourceMappingURL=Reference.js.map